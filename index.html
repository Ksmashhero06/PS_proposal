<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday üñ§</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --black-primary: #0A0A0A;
            --black-secondary: #0F0F15;
            --black-tertiary: #1A1A20;
            --gold-primary: #D4AF37;
            --gold-light: #E8D5B7;
            --white-soft: #F5F5F5;
            --rose-dark: #2A1425;
            --rose-accent: #C04060;
            --glass-dark: rgba(212, 175, 55, 0.06);
            --glass-border: rgba(212, 175, 55, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(180deg, #0A0A0A 0%, #1A0F1A 100%);
            color: var(--white-soft);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Starry Background */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: var(--white-soft);
            border-radius: 50%;
            animation: twinkle 4s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 0.6; }
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            pointer-events: none;
        }

        .screen.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Birthday Screen */
        .birthday-screen {
            text-align: center;
        }

        .birthday-title {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            color: var(--gold-primary);
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
            animation: fadeInDown 1.2s ease-out;
        }

        .birthday-subtitle {
            font-size: 1.3rem;
            color: var(--gold-light);
            margin-bottom: 40px;
            animation: fadeInUp 1.2s ease-out 0.2s both;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translate3d(0,-30px,0); }
            to { opacity: 1; transform: translate3d(0,0,0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translate3d(0,30px,0); }
            to { opacity: 1; transform: translate3d(0,0,0); }
        }

        @keyframes confettiFall {
            0% { transform: translate3d(0,-100vh,0) rotateZ(0deg); opacity: 1; }
            100% { transform: translate3d(0,100vh,0) rotateZ(360deg); opacity: 0; }
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0.9;
            border-radius: 2px;
            animation: confettiFall 4s linear infinite;
        }

        /* Proposal Screen */
        .proposal-screen {
            flex-direction: column;
            gap: 30px;
            justify-content: center;
        }

        .proposal-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            flex-wrap: wrap;
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }

        .anime-boy-container {
            position: relative;
            width: 280px;
            height: 350px;
            border-radius: 20px;
            overflow: hidden;
            border: 4px solid var(--gold-primary);
            box-shadow: 0 15px 50px rgba(212, 175, 55, 0.6);
            animation: floatFeatured 4s ease-in-out infinite;
            flex-shrink: 0;
            z-index: 3;
        }

        .anime-boy-container::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 35% 30%, rgba(212, 175, 55, 0.3), transparent);
            animation: glowPulse 3s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
            pointer-events: none;
            z-index: 1;
        }

        .anime-boy-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: saturate(1.2) brightness(1.1);
            transition: all 0.6s ease;
        }

        /* Boy holding container effect */
        .anime-boy-container::before {
            content: '';
            position: absolute;
            left: -30px;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            height: 200px;
            background: radial-gradient(ellipse at 50% 50%, rgba(212, 175, 55, 0.2), transparent);
            border-radius: 50%;
            z-index: 2;
            animation: holdingGlow 3s ease-in-out infinite;
        }

        @keyframes holdingGlow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .proposal-card {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
            text-align: center;
            z-index: 2;
        }

        .proposal-text {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: var(--gold-primary);
            text-align: center;
            line-height: 1.6;
            animation: fadeInUp 1s ease-out 0.3s both;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
        }

        .proposal-subtext {
            font-size: 1.1rem;
            color: var(--gold-light);
            text-align: center;
            margin-top: 10px;
            animation: fadeInUp 1s ease-out 0.5s both;
        }

        .response-quotes {
            margin: 20px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: slideInQuote 0.6s ease-out;
        }

        @keyframes slideInQuote {
            from { opacity: 0; transform: translate3d(0, 10px, 0); }
            to { opacity: 1; transform: translate3d(0, 0, 0); }
        }

        .quote-text {
            font-size: 1rem;
            color: var(--rose-accent);
            font-style: italic;
            line-height: 1.6;
            margin: 0;
        }

        @keyframes floatGently {
            0%, 100% { transform: translate3d(0,0,0); }
            50% { transform: translate3d(0,-8px,0); }
        }

        @keyframes floatFeatured {
            0%, 100% { transform: translate3d(0,0,0) scale(1); }
            25% { transform: translate3d(0,-12px,0) scale(1.02); }
            50% { transform: translate3d(0,-4px,0) scale(1); }
            75% { transform: translate3d(0,-10px,0) scale(1.02); }
        }

        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.4); }
            50% { box-shadow: 0 0 40px rgba(212, 175, 55, 0.7); }
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.1rem;
            padding: 12px 30px;
            border: 2px solid var(--gold-primary);
            background: transparent;
            color: var(--gold-primary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.4s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, var(--gold-primary), var(--gold-light));
            transition: left 0.4s ease;
            z-index: -1;
        }

        button:hover::before {
            left: 0;
        }

        button:hover {
            color: var(--black-primary);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
            transform: translateY(-2px);
        }

        #yes-btn {
            background: var(--gold-primary);
            color: var(--black-primary);
            animation: yesPulse 2s ease-in-out infinite;
        }

        @keyframes yesPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(212, 175, 55, 0.5); transform: translate3d(0,0,0) scale(1); }
            50% { box-shadow: 0 0 30px rgba(212, 175, 55, 0.9); transform: translate3d(0,-2px,0) scale(1.03); }
        }

        #no-btn {
            position: relative;
            background: var(--black-tertiary);
            border-color: var(--rose-accent);
            color: var(--rose-accent);
        }

        /* Flip Cards Screen */
        .cards-screen {
            flex-direction: column;
            gap: 20px;
        }

        .instruction {
            font-size: 1.2rem;
            color: var(--gold-primary);
            text-align: center;
            margin-bottom: 20px;
            animation: fadeInDown 1s ease-out;
        }

        .cards-container {
            display: flex;
            justify-content: center;
            gap: 25px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .flip-card {
            width: 220px;
            height: 300px;
            perspective: 1000px;
            cursor: pointer;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform-style: preserve-3d;
        }

        .flip-card:hover .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card.tap .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--gold-primary);
            text-align: center;
            background: var(--glass-dark);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .flip-card-front {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(160, 51, 78, 0.15));
        }

        .flip-card-back {
            background: linear-gradient(135deg, rgba(160, 51, 78, 0.2), rgba(212, 175, 55, 0.1));
            transform: rotateY(180deg);
        }

        .card-boy-img {
            width: 60px;
            height: 80px;
            border-radius: 8px;
            border: 2px solid var(--gold-primary);
            margin-bottom: 10px;
            object-fit: cover;
        }

        .card-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            color: var(--gold-primary);
            margin-bottom: 10px;
        }

        .card-text {
            font-size: 0.95rem;
            color: var(--gold-light);
            line-height: 1.5;
        }

        .card-icon {
            font-size: 2rem;
            margin-top: 10px;
            animation: floatGently 3s ease-in-out infinite;
        }

        .read-heart-btn {
            margin-top: 30px;
            background: var(--gold-primary);
            color: var(--black-primary);
            font-size: 1rem;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 99;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(135deg, var(--black-secondary) 0%, var(--rose-dark) 100%);
            border: 2px solid var(--gold-primary);
            border-radius: 15px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(212, 175, 55, 0.3);
            animation: slideUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes slideUp {
            from { transform: translate3d(0,100px,0); opacity: 0; }
            to { transform: translate3d(0,0,0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .modal-boy-img {
            width: 120px;
            height: 150px;
            border-radius: 15px;
            border: 3px solid var(--gold-primary);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.5);
            object-fit: cover;
        }

        .modal-content h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: var(--gold-primary);
            text-align: center;
            text-shadow: 0 2px 10px rgba(212, 175, 55, 0.3);
            margin: 0;
            flex: 1;
            min-width: 200px;
        }

        .modal-content p {
            font-size: 1.05rem;
            color: var(--gold-light);
            line-height: 1.8;
            margin-bottom: 15px;
            text-align: justify;
        }

        .close-modal-btn {
            margin-top: 20px;
            width: 100%;
            background: var(--gold-primary);
            color: var(--black-primary);
            border: none;
        }

        /* Theme Toggle & Navigation */
        .header-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 12px;
            z-index: 100;
            align-items: center;
        }

        .theme-toggle, .back-btn {
            background: var(--gold-primary);
            color: var(--black-primary);
            border: 2px solid var(--gold-primary);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.4s ease;
            font-family: 'Montserrat', sans-serif;
        }

        .theme-toggle:hover, .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
        }

        .back-btn {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
            position: relative;
        }

        .back-btn.show {
            opacity: 1;
            pointer-events: auto;
        }

        .back-btn:active {
            transform: scale(0.95);
        }

        /* Light Mode Theme */
        body.light-mode {
            background: linear-gradient(180deg, #1A1A1A 0%, #2D1A2D 100%);
            --black-primary: #1A1A1A;
            --black-secondary: #242424;
            --black-tertiary: #2F2F2F;
            --gold-primary: #D4AF37;
            --gold-light: #E8D5B7;
            --white-soft: #F0F0F0;
            --rose-dark: #2A1425;
            --rose-accent: #D4748A;
            --glass-dark: rgba(212, 175, 55, 0.08);
            --glass-border: rgba(212, 175, 55, 0.2);
        }

        body.light-mode .star {
            background: rgba(230, 230, 230, 0.5);
        }

        body.light-mode .flip-card-front {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.25), rgba(212, 116, 138, 0.25));
            border-color: #D4AF37;
        }

        body.light-mode .flip-card-back {
            background: linear-gradient(135deg, rgba(212, 116, 138, 0.3), rgba(212, 175, 55, 0.2));
            border-color: #D4AF37;
        }

        body.light-mode .modal-content {
            background: linear-gradient(135deg, #2A2A2A 0%, #3A2535 100%);
            border-color: #D4AF37;
        }

        body.light-mode .theme-toggle {
            background: var(--gold-primary);
            color: #1A1A1A;
        }

        body.light-mode .back-btn {
            background: var(--gold-primary);
            color: #1A1A1A;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-controls {
                top: 15px;
                right: 15px;
                gap: 8px;
            }

            .theme-toggle, .back-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }

            .birthday-title {
                font-size: 2.5rem;
            }

            .proposal-container {
                flex-direction: column;
                gap: 25px;
            }

            .anime-boy-container {
                width: 200px;
                height: 250px;
            }

            .proposal-text {
                font-size: 1.4rem;
            }

            .proposal-card {
                min-width: 280px;
            }

            .cards-container {
                gap: 15px;
            }

            .flip-card {
                width: 180px;
                height: 250px;
            }

            .modal-content {
                padding: 25px;
            }

            .modal-header {
                flex-direction: column;
            }

            .modal-boy-img {
                width: 100px;
                height: 130px;
            }
        }
    </style>
</head>
<body>
    <div class="stars" id="starfield"></div>

    <!-- Header Controls -->
    <div class="header-controls">
        <button class="back-btn" id="backBtn" onclick="goBack()">‚Üê Back</button>
        <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">üåô Dark</button>
    </div>

    <div class="container">
        <!-- Birthday Screen -->
        <div class="screen birthday-screen active">
            <h1 class="birthday-title">Happy Birthday üñ§</h1>
            <p class="birthday-subtitle">A moment I've dreamed about for so long...</p>
            <button onclick="handleBirthdayClick()" style="margin-top: 20px;">Continue Your Journey</button>
        </div>

        <!-- Proposal Screen -->
        <div class="screen proposal-screen">
            <div class="proposal-container">
                <div class="anime-boy-container">
                    <img id="animeBoySadExpr" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a838fb0c-50a8-457c-ae98-2f022f01ebe6.png" alt="Happy Anime Boy" class="anime-boy-img" style="display: block;">
                    <img id="animeBoySadImg" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/4670b564-e3b8-487d-8f4c-4cabfae10c7b.png" alt="Sad Anime Boy" class="anime-boy-img" style="display: none;">
                    <img id="animeBoyThinkImg" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/15a91cd3-8113-47c6-9c4f-86852d8d18fb.png" alt="Thinking Anime Boy" class="anime-boy-img" style="display: none;">
                    <img id="animeBoyHappyImg" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/cb713fbb-ace3-4f32-ad18-07856c407d00.png" alt="Happy Winking Anime Boy" class="anime-boy-img" style="display: none;">
                </div>

                <div class="proposal-card">
                    <h1 class="proposal-text">Would you do me the honor of being my most cherished love? üåπ</h1>
                    <p class="proposal-subtext">Every moment with you feels like a dream I never want to wake from...</p>
                    
                    <div id="responseQuotes" class="response-quotes" style="display: none; min-height: 60px;">
                        <p class="quote-text"></p>
                    </div>

                    <div class="button-group">
                        <button id="yes-btn" onclick="handleYes()">Yes ‚ô•</button>
                        <button id="letme-btn" onclick="handleLetMeThink()">Let me think...</button>
                        <button id="nope-btn" onclick="handleNope()">Nope</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flip Cards Screen -->
        <div class="screen cards-screen">
            <p class="instruction">‚ú® Hover or tap to reveal the depths of my affection ‚ú®</p>
            
            <div class="cards-container">
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a838fb0c-50a8-457c-ae98-2f022f01ebe6.png" alt="Our Beginning" class="card-boy-img">
                            <h3 class="card-title">Our Beginning</h3>
                            <p class="card-text">The moment you entered my life, everything changed.</p>
                            <span class="card-icon">üí´</span>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="card-title">For You</h3>
                            <p class="card-text">Every line of code I write whispers your name.</p>
                        </div>
                    </div>
                </div>

                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a838fb0c-50a8-457c-ae98-2f022f01ebe6.png" alt="Infinite Moments" class="card-boy-img">
                            <h3 class="card-title">Infinite Moments</h3>
                            <p class="card-text">With you, forever feels like a beautiful blink.</p>
                            <span class="card-icon">üåô</span>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="card-title">My Exception</h3>
                            <p class="card-text">You are the bug I never want to fix, the constant in my variables.</p>
                        </div>
                    </div>
                </div>

                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a838fb0c-50a8-457c-ae98-2f022f01ebe6.png" alt="Forever Promise" class="card-boy-img">
                            <h3 class="card-title">Forever Promise</h3>
                            <p class="card-text">Like a loop that never breaks, like love that never ends.</p>
                            <span class="card-icon">üîê</span>
                        </div>
                        <div class="flip-card-back">
                            <h3 class="card-title">Eternal Constant</h3>
                            <p class="card-text">While(true) { love(you); } Forever yours.</p>
                        </div>
                    </div>
                </div>
            </div>

            <button class="read-heart-btn" onclick="handleReadHeart()">Read My Heart ‚ô•</button>
        </div>
    </div>

    <!-- Love Letter Modal -->
    <div class="modal" id="loveModal">
        <div class="modal-content">
            <div class="modal-header">
                <img class="modal-boy-img" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a838fb0c-50a8-457c-ae98-2f022f01ebe6.png" alt="Happy Smiling Anime Boy">
                <h2>My Most Cherished</h2>
            </div>
            <p>
                Every moment in your presence feels like a beautiful dream I never wish to wake from. Your smile illuminates my darkest days, and your laughter is the melody my heart has been waiting to hear all along.
            </p>
            <p>
                You are not merely someone I love‚Äîyou are my confidant, my inspiration, my greatest blessing. In a world of infinite possibilities, you are the one choice I would make again and again, without hesitation.
            </p>
            <p>
                I promise to cherish you, to support you through every season of life, and to remind you every single day that you are worthy of the deepest, most genuine love. You are my forever, my destiny, my home.
            </p>
            <p style="margin-top: 30px; color: var(--gold-primary); font-size: 1.1rem; font-style: italic;">
                Forever, and always, yours. üíï
            </p>
            <button class="close-modal-btn" onclick="handleCloseModal()">Close with Love ‚ú®</button>
        </div>
    </div>

    <script>
        // Audio Context for sound effects
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playClickSound() {
            const now = audioContext.currentTime;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.frequency.value = 800;
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            osc.start(now);
            osc.stop(now + 0.1);
        }

        function playSuccessSound() {
            const now = audioContext.currentTime;
            const notes = [523.25, 659.25, 783.99]; // C, E, G
            notes.forEach((freq, idx) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.frequency.value = freq;
                osc.type = 'sine';
                const startTime = now + idx * 0.1;
                gain.gain.setValueAtTime(0.3, startTime);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.2);
                osc.start(startTime);
                osc.stop(startTime + 0.2);
            });
        }

        function playSadSound() {
            const now = audioContext.currentTime;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.frequency.setValueAtTime(400, now);
            osc.frequency.exponentialRampToValueAtTime(200, now + 0.4);
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
            osc.start(now);
            osc.stop(now + 0.4);
        }

        function playTapSound() {
            const now = audioContext.currentTime;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.frequency.value = 1200;
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
            osc.start(now);
            osc.stop(now + 0.15);
        }

        // Generate starfield + confetti
        function generateStars() {
            const starfield = document.getElementById('starfield');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 2 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 4 + 's';
                starfield.appendChild(star);
            }

            for (let i = 0; i < 20; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = Math.random() * 100 + '%';
                conf.style.animationDelay = (Math.random() * 4) + 's';
                conf.style.background = Math.random() > 0.5 ? '#D4AF37' : '#C04060';
                starfield.appendChild(conf);
            }
        }

        function handleBirthdayClick() {
            playClickSound();
            goToProposal();
        }

        function goToProposal() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelector('.proposal-screen').classList.add('active');
            document.getElementById('backBtn').classList.add('show');
        }

        function goToCards() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelector('.cards-screen').classList.add('active');
            document.getElementById('backBtn').classList.add('show');
        }

        function showModal() {
            document.getElementById('loveModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('loveModal').classList.remove('show');
        }

        // Love quotes for different responses
        const sadQuotes = [
            "üíî Ah... but I'll keep waiting...",
            "üíî Maybe my timing wasn't right...",
            "üíî That one stung... üò¢",
            "üíî But I still believe in us...",
            "üíî Your hesitation breaks my heart...",
            "üíî I'll always hope for a yes...",
            "üíî Please reconsider... ü•∫"
        ];

        const thinkingQuotes = [
            "ü§î Taking your time to decide, huh?",
            "ü§î That's fair... I can wait... üí≠",
            "ü§î Thinking it through... I respect that.",
            "ü§î Take all the time you need... ‚ú®",
            "ü§î Good things are worth thinking about...",
            "ü§î I'm nervous but hopeful... üíï"
        ];

        let nopeClickCount = 0;
        let thinkClickCount = 0;

        function handleYes() {
            playSuccessSound();
            document.getElementById('animeBoySadExpr').style.display = 'none';
            document.getElementById('animeBoySadImg').style.display = 'none';
            document.getElementById('animeBoyThinkImg').style.display = 'none';
            document.getElementById('animeBoyHappyImg').style.display = 'block';
            document.getElementById('responseQuotes').style.display = 'none';
            
            setTimeout(() => {
                goToCards();
            }, 1000);
        }

        function handleNope() {
            playClickSound();
            playSadSound();
            nopeClickCount++;
            document.getElementById('animeBoySadExpr').style.display = 'none';
            document.getElementById('animeBoyThinkImg').style.display = 'none';
            document.getElementById('animeBoyHappyImg').style.display = 'none';
            document.getElementById('animeBoySadImg').style.display = 'block';
            
            const randomSadQuote = sadQuotes[Math.floor(Math.random() * sadQuotes.length)];
            document.querySelector('.quote-text').textContent = randomSadQuote;
            document.getElementById('responseQuotes').style.display = 'flex';
        }

        function handleLetMeThink() {
            playClickSound();
            thinkClickCount++;
            document.getElementById('animeBoySadExpr').style.display = 'none';
            document.getElementById('animeBoySadImg').style.display = 'none';
            document.getElementById('animeBoyHappyImg').style.display = 'none';
            document.getElementById('animeBoyThinkImg').style.display = 'block';
            
            const randomThinkQuote = thinkingQuotes[Math.floor(Math.random() * thinkingQuotes.length)];
            document.querySelector('.quote-text').textContent = randomThinkQuote;
            document.getElementById('responseQuotes').style.display = 'flex';
        }

        function handleReadHeart() {
            playClickSound();
            showModal();
        }

        function handleCloseModal() {
            playClickSound();
            closeModal();
        }

        // Theme Management
        function detectSystemTheme() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                return 'dark';
            }
            return 'light';
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const theme = savedTheme || detectSystemTheme();
            applyTheme(theme);
        }

        function applyTheme(theme) {
            const body = document.body;
            const themeToggle = document.getElementById('themeToggle');
            
            if (theme === 'light') {
                body.classList.add('light-mode');
                themeToggle.textContent = '‚òÄÔ∏è Light';
                localStorage.setItem('theme', 'light');
                themeToggle.style.background = '#D4AF37';
                themeToggle.style.borderColor = '#D4AF37';
            } else {
                body.classList.remove('light-mode');
                themeToggle.textContent = 'üåô Dark';
                localStorage.setItem('theme', 'dark');
                themeToggle.style.background = '#D4AF37';
                themeToggle.style.borderColor = '#D4AF37';
            }
        }

        function toggleTheme() {
            playClickSound();
            const body = document.body;
            const currentTheme = body.classList.contains('light-mode') ? 'light' : 'dark';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
        }

        // Navigation Management
        function goBack() {
            playClickSound();
            const currentScreen = document.querySelector('.screen.active');
            const birthday = document.querySelector('.birthday-screen');
            const proposal = document.querySelector('.proposal-screen');
            const cards = document.querySelector('.cards-screen');
            const backBtn = document.getElementById('backBtn');

            if (currentScreen === proposal) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                birthday.classList.add('active');
                backBtn.classList.remove('show');
                closeModal();
            } else if (currentScreen === cards) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                proposal.classList.add('active');
                closeModal();
            }
        }

        // Enable tap-to-flip on touch devices
        function enableTapFlip() {
            const cards = document.querySelectorAll('.flip-card');
            cards.forEach(card => {
                card.addEventListener('click', function () {
                    playTapSound();
                    this.classList.toggle('tap');
                });
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const birthdayScreen = document.querySelector('.birthday-screen');
            const continueBtn = birthdayScreen ? birthdayScreen.querySelector('button') : null;
            
            if (continueBtn) {
                continueBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                });
            }
            
            const readHeartBtn = document.querySelector('.read-heart-btn');
            if (readHeartBtn) {
                readHeartBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                });
            }
            
            const closeModalBtn = document.querySelector('.close-modal-btn');
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                });
            }

            const backBtn = document.getElementById('backBtn');
            if (backBtn) {
                backBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                });
            }

            const themeToggleBtn = document.getElementById('themeToggle');
            if (themeToggleBtn) {
                themeToggleBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                });
            }

            generateStars();
            enableTapFlip();
            initTheme();
        });

        // System theme listener
        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                if (!localStorage.getItem('theme')) {
                    applyTheme(e.matches ? 'dark' : 'light');
                }
            });
        }
    </script>
</body>
</html>
